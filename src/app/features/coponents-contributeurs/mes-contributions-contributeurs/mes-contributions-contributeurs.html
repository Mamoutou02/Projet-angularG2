<div class="top-bar">
  <div class="tabs">
    <button class="tab" [class.active]="activeTab === 'contribution'" (click)="switchTab('contribution')">
      Contribution
    </button>
    <button class="tab" [class.active]="activeTab === 'features'" (click)="switchTab('features')">
      Fonctionnalités
    </button>
    <button routerLink="/ProjetsRejoints">Retour</button>
  </div>
</div>

<div class="content">

  <!-- Onglet Contribution -->
  <div *ngIf="activeTab === 'contribution'">
    <div class="add-container">
      <button class="btn-ajouter" [routerLink]="['/NewContribution']" 
              [queryParams]="{ fonctionnaliteId: selectedFonctionnaliteId, projetId: selectedProjetId }">
        <i class="fa fa-plus"></i> Ajouter
      </button>
    </div>

    <div class="card-container">
      <div class="card" *ngFor="let item of contributions">
        <div class="card-header">
          <div class="icon-circle"><i class="fa {{item.icon}}"></i></div>
          <div class="card-title">{{item.title}}</div>
          <div class="card-date"><i class="fa fa-calendar"></i> {{item.date | date:'short'}}</div>
        </div>

        <div class="card-body">
          <p><strong>Description :</strong> {{item.description}}</p>
          <div class="card-status">
            <span class="status"
                  [ngClass]="{
                    'en_cours': item.status === 'EN_COURS',
                    'termine': item.status === 'TERMINE',
                    'attente': item.status === 'EN_ATTENTE'
                  }">
              <strong>Statut :</strong> {{ item.statusText }}
            </span>
          </div>
        </div>

        <div class="card-footer">
          <a class="details-link" (click)="openContributionDetails(item)">Voir détails</a>
        </div>
      </div>
    </div>
  </div>

  <!-- Onglet Fonctionnalités -->
  <div *ngIf="activeTab === 'features'" class="fonctionnalites-cards-container">

    <!-- Mes fonctionnalités réservées -->
    <h3>Mes fonctionnalités réservées</h3>
    <div *ngFor="let fonc of mesFonctionnalites" class="fonctionnalite-card">
      <h4>{{ fonc.fonctionnaliteDescription }}</h4>
      <div class="fonctionnalite-info">
        <span><strong>ID:</strong> {{ fonc.id }}</span>
        <span><strong>Points:</strong> {{ fonc.pointFonctionnalite }}</span>
        <span><strong>Statut:</strong> 
          <span class="badge en_cours">{{ fonc.statut }}</span>
        </span>
      </div>
      <button class="btn-faire" 
              [disabled]="fonc.statut?.trim().toUpperCase() !== 'RESERVEE' || hasContributed(fonc.id)"
              (click)="openContributionModal(fonc.id, fonc.projetId)">
        {{ hasContributed(fonc.id) ? 'Déjà fait' : 'Faire' }}
      </button>
    </div>

    <!-- Fonctionnalités disponibles -->
    <h3>Fonctionnalités disponibles</h3>
    <div *ngFor="let fonc of fonctionnalitesDisponibles" class="fonctionnalite-card">
      <h4>{{ fonc.fonctionnaliteDescription }}</h4>
      <div class="fonctionnalite-info">
        <span><strong>ID:</strong> {{ fonc.id }}</span>
        <span><strong>Points:</strong> {{ fonc.pointFonctionnalite }}</span>
        <span><strong>Statut:</strong> <span class="badge disponible">DISPONIBLE</span></span>
      </div>
      <button class="btn-reserver" (click)="reserverFonctionnalite(fonc.id)">Réserver</button>
    </div>

    <!-- Fonctionnalités réservées par d’autres -->
    <h3>Fonctionnalités réservées par d'autres</h3>
    <div *ngFor="let fonc of fonctionnalitesReservees" class="fonctionnalite-card">
      <h4>{{ fonc.fonctionnaliteDescription }}</h4>
      <div class="fonctionnalite-info">
        <span><strong>ID:</strong> {{ fonc.id }}</span>
        <span><strong>Points:</strong> {{ fonc.pointFonctionnalite }}</span>
        <span><strong>Statut:</strong> 
          <span class="badge" [ngClass]="{
            'disponible': fonc.statut === 'DISPONIBLE',
            'reservee': fonc.statut === 'RESERVEE',
            'terminee': fonc.statut === 'TERMINEE'
          }">{{ fonc.statut }}</span>
        </span>
        <span><strong>Réservé par:</strong> {{ fonc.contributeur?.email }}</span>
      </div>
    </div>

  </div>
</div>
