<div class="top-bar">
  <div class="tabs">
    <button class="tab" [class.active]="activeTab === 'contribution'" (click)="switchTab('contribution')">
      Contribution
    </button>
    <button class="tab" [class.active]="activeTab === 'features'" (click)="switchTab('features')">
      Fonctionnalités
    </button>
    <button routerLink="/ProjetsRejoints">Retour</button>
  </div>
</div>

<div class="content">
  <!-- Onglet Contributions -->
  <div *ngIf="activeTab === 'contribution'" class="card-container">
    

    <div class="card" *ngFor="let item of contributions">
      <div class="card-header">
        <div class="icon-circle"><i class="fa {{item.icon}}"></i></div>
        <div class="card-title">{{item.title}}</div>
        <div class="card-date"><i class="fa fa-calendar"></i> {{item.date | date:'short'}}</div>
      </div>
      <div class="card-body">
        <p><strong>Description :</strong> {{item.description}}</p>
        <div class="card-status">
          <span class="status" [ngClass]="{
            'en_cours': item.status === 'en_cours',
            'termine': item.status === 'termine',
            'attente': item.status === 'en_attente'}">
            <strong>Statut :</strong> {{ item.statusText }}
          </span>
        </div>
      </div>
      <div class="card-footer">
        <a class="details-link" (click)="openContributionDetails(item)">Voir détails</a>
      </div>
    </div>
  </div>

  <!-- Onglet Fonctionnalités -->
  <div *ngIf="activeTab === 'features'" class="fonctionnalites-cards-container">
    <div class="project-info" *ngIf="currentProjectId">
      
    </div>

    <!-- Fonctionnalités disponibles -->
    <h3>Fonctionnalités disponibles</h3>
    <div *ngFor="let fonc of fonctionnalitesDisponibles" class="fonctionnalite-card">
      <h4>{{ fonc.fonctionnaliteDescription }}</h4>
      <div class="fonctionnalite-info">
        <span><strong>N:</strong> {{ fonc.id }}</span>
        <span><strong>Points:</strong> {{ fonc.pointFonctionnalite }}</span>
        <span><strong>Statut:</strong> <span class="badge disponible">DISPONIBLE</span></span>
      </div>
      <button class="btn-reserver" (click)="reserverFonctionnalite(fonc.id)">Réserver</button>
    </div>

    <!-- Fonctionnalités réservées -->
<!-- Fonctionnalités réservées (toutes) -->
  <div *ngFor="let fonc of fonctionnalitesReservees" class="fonctionnalite-card">
    <h4>{{ fonc.fonctionnaliteDescription }}</h4>
    <div class="fonctionnalite-info">
      <span><strong>N:</strong> {{ fonc.id }}</span>
      <span><strong>Points:</strong> {{ fonc.pointFonctionnalite }}</span>
      <span><strong>Statut:</strong> 
        <span class="badge en_cours">{{ fonc.statut }}</span>
      </span>
      <span *ngIf="fonc.contributeur"><strong>Réservé par:</strong> {{ fonc.contributeur?.email }}</span>
    </div>

    <!-- Bouton Faire - Apparaît pour TOUTES les fonctionnalités réservées -->
    <button class="btn-faire" (click)="openContributionModal(fonc.id)">
      Faire
    </button>
  </div>

  </div>

  <!-- Modal Nouvelle Contribution -->
  <app-new-contribution 
  *ngIf="isModalOpen && currentProjectId && selectedFonctionnaliteId"
  [fonctionnaliteId]="selectedFonctionnaliteId"
  [projetId]="currentProjectId"
  [idContributeur]="idContributeur" 
  (close)="closeContributionModal()"
  (submit)="onContributionSubmitted()">
</app-new-contribution>
</div>